# 📘 Code Quality Rule Document(実装・レビュー運用編)

## 🛠 開発ツールの選定ルール

| 領域       | 推奨ツール             | 条件・理由                                           |
|------------|------------------------|------------------------------------------------------|
| エディタ   | VSCode or Kiro or Cursor| Kiro連携、Amazon Q拡張、Spec記述補助が可能         |
| Linter     | Ruff +mypy             | Ruffで構文・スタイル、mypyで静的型チェックを補完        |
| フォーマッタ | Black                 | 行長制限と構文整形の一貫性を保証(Ruffで代替可能なら省略しても良い) |
| 型チェック       | mypy                   | Pythonコードの型整合性を静的に検証                 |
| テスト     | Pytest                 | 構造的な失敗ログと柔軟なフィクスチャ設計が可能     |
| Spec駆動   | Kiro                   | 明示的な目的記述と実装制約の管理に最適             |
| デバッグ   | Amazon Q Developer     | IDE連携、自然言語でのログ解釈と改善提案が可能      |
| ドキュメント | Markdown + Mermaid   | 構造図と意味記述の両立が可能、Specとの親和性高     |
| セキュリティ検査 | Bandit / Semgrep       | 静的解析による脆弱性検出、CI統合しやすい           |

---

## 📏  コーディング設計指針(数値ベース・努力目標)

| 項目             | 制限値         | 理由                                               |
|------------------|----------------|----------------------------------------------------|
| 行長             | 88文字         | 読みやすさとツール互換性のバランス               |
| 関数長           | 最大40行       | 1関数＝1意味単位を守るための目安                 |
| ファイル長       | 最大500行      | 構造分割と責務分離を促すため                     |
| コメント密度     | 最低5%         | 意図・前提・制約を明示するための最低限の記述量   |
| テストカバレッジ | 80%以上        | 単なる網羅ではなく、失敗の意味を保証することが目的 |

---

## 🔍 レビュー運用ルール

- **Specとの整合性を最優先**
  実装がSpec(.kiro/specs/*/*.md)の目的・制約・前提と一致しているかを確認。Specが曖昧な場合はレビューで補完。

- **Amazon Qでのログ解釈性を考慮**
  ログメッセージは自然言語で意味が伝わるように記述。
  例：`Failed to parse config: missing 'env' key` はOK、`Error 500` はNG。

- **コメントは未来の自分への手紙**
  なぜその実装にしたか、Specとの関係、想定される失敗パターンを記述する。

- **テストは「通るか」より「失敗が意味を持つか」**
  通過率よりも、失敗時に何がわかるかを重視。
  レビューでは「このテストが失敗したら、何がわかるか？」を問う。

- **セキュリティレビューはCIで自動化し、意味ある警告だけを残す**
  BanditやSemgrepの警告は「なぜそれが危険か」をレビューコメントに明示する。

---

## 🧪 実験領域の扱い

- 検証や実験コードは `playground/` ディレクトリに隔離
  例：テスト用ファイル、動作検証スクリプトなど

- 実験コードにも最低限のSpecを付与
  → 目的・前提・制約・期待される崩壊パターンを記述

---
