# インデックス再構築機能 実装計画

- [x] 1. タイムアウト管理システムの実装
  - RebuildTimeoutManagerクラスを作成してタイムアウト監視機能を実装
  - QTimerを使用した30分タイムアウトの実装
  - タイムアウト発生時のシグナル送信機能
  - _要件: 6.1, 6.2, 6.3_

- [x] 2. 再構築状態管理データクラスの実装
  - RebuildStateデータクラスを作成して再構築状態を管理
  - RebuildProgressデータクラスを作成して進捗情報を管理
  - タイムアウト判定機能と表示メッセージ生成機能を実装
  - _要件: 2.1, 2.2, 6.5_

- [x] 3. メインウィンドウの_rebuild_indexメソッド実装
  - 既存のプレースホルダーコードを削除
  - 確認ダイアログの表示機能を実装
  - 現在選択されているフォルダパスの取得機能を実装
  - IndexManagerのclear_indexメソッドを呼び出してインデックスクリア
  - _要件: 1.1, 1.2, 3.3_

- [x] 4. IndexingThreadManagerとの連携実装
  - IndexingThreadManagerのstart_indexing_threadメソッドを呼び出す処理を実装
  - 既存のthread_managerインスタンスを活用
  - スレッド開始エラーの適切な処理を実装
  - _要件: 1.3, 7.1, 7.2_

- [x] 5. 進捗表示システムの統合
  - IndexingWorkerの進捗シグナルを受信する_on_rebuild_progressメソッドを実装
  - 既存のshow_progress、update_progress、hide_progressメソッドを活用
  - 段階別進捗メッセージ（スキャン、処理、インデックス、完了）の表示
  - _要件: 2.1, 2.2, 4.1_

- [x] 6. 完了処理とシステム状態更新の実装
  - IndexingThreadManagerの完了シグナルを受信する_on_rebuild_completedメソッドを実装
  - SearchManagerのclear_suggestion_cacheメソッドを呼び出してキャッシュクリア
  - システム情報ラベルの更新処理を実装
  - フォルダツリーの状態更新処理を実装
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [x] 7. エラーハンドリングシステムの実装
  - IndexingThreadManagerのエラーシグナルを受信する_on_rebuild_errorメソッドを実装
  - エラータイプ別の処理分岐（ファイルエラー、システムエラー、タイムアウト）を実装
  - 部分的インデックスのクリーンアップ処理を実装
  - ユーザー向けエラーダイアログの表示機能を実装
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 8. タイムアウト処理の統合
  - タイムアウト発生時の_handle_rebuild_timeoutメソッドを実装
  - IndexingThreadManagerのstop_threadメソッドを使用した強制停止処理
  - タイムアウトダイアログの表示とユーザー選択処理
  - タイムアウト後のクリーンアップと状態リセット処理
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [x] 9. シグナル接続とライフサイクル管理
  - _connect_rebuild_signalsメソッドを実装してすべてのシグナル接続を管理
  - メインウィンドウ初期化時のシグナル接続処理を追加
  - アプリケーション終了時のクリーンアップ処理を実装
  - _要件: 7.3, 4.2_

- [x] 10. ユーザーインターフェース改善
  - 確認ダイアログのメッセージとボタン配置を改善
  - 進捗表示の視覚的改善（アイコン、色分け）
  - エラーダイアログの分かりやすいメッセージ作成
  - タイムアウトダイアログの実装
  - _要件: 2.3, 3.2, 6.2_

- [ ] 11. 統合テストとデバッグ
  - 小規模フォルダでの動作確認テストを実装
  - 大規模フォルダでのパフォーマンステストを実装
  - エラー条件での動作確認テストを実装
  - タイムアウト処理のテストを実装
  - _要件: 4.4, 6.5_

- [ ] 12. 最終統合とドキュメント更新
  - すべての機能を統合して動作確認
  - エラーログとデバッグ情報の最適化
  - コードコメントと日本語ドキュメントの更新
  - ユーザーマニュアルの更新
  - _要件: 7.4_
