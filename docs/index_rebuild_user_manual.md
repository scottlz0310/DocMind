# インデックス再構築機能 ユーザーマニュアル

## 概要

DocMindのインデックス再構築機能は、検索インデックスを手動で再作成する機能です。この機能により、検索結果が不正確になった場合や新しいドキュメントが追加された場合に、検索性能を回復できます。

## 機能の目的

- **検索精度の向上**: 古いインデックスによる不正確な検索結果を修正
- **新規ドキュメントの反映**: 手動で追加されたドキュメントをインデックスに含める
- **インデックス破損の修復**: システム異常により破損したインデックスの復旧
- **パフォーマンスの最適化**: 断片化したインデックスの最適化

## 使用方法

### 1. インデックス再構築の開始

1. **メニューからの実行**
   - メニューバーの「検索」→「インデックス再構築」を選択
   - または、キーボードショートカット `Ctrl+R` を使用

2. **確認ダイアログ**
   - インデックス再構築の確認ダイアログが表示されます
   - 「はい」をクリックして処理を開始します
   - 「いいえ」をクリックして処理をキャンセルできます

### 2. 進捗の確認

インデックス再構築中は以下の情報が表示されます：

- **ステータスバー**: 現在の処理状況（スキャン中、処理中、インデックス作成中）
- **進捗バー**: 処理の進捗率（パーセンテージ）
- **処理数表示**: 「処理済み/総数」形式での詳細進捗

#### 進捗段階の説明

1. **🔍 スキャン段階**: フォルダ内のファイルを検索中
2. **⚙️ 処理段階**: 各ドキュメントのテキスト抽出中
3. **📚 インデックス段階**: 検索インデックスの作成中
4. **✅ 完了段階**: すべての処理が完了

### 3. 処理の完了

インデックス再構築が完了すると：

- 完了メッセージが表示されます
- 進捗バーが非表示になります
- システム情報が更新されます
- 検索機能が新しいインデックスを使用するようになります

## 注意事項

### 処理時間について

- **小規模フォルダ（～1,000ファイル）**: 通常1-5分
- **中規模フォルダ（1,000-10,000ファイル）**: 通常5-15分
- **大規模フォルダ（10,000ファイル以上）**: 15分以上

### システム要件

- **メモリ**: 処理中は通常より多くのメモリを使用します
- **CPU**: バックグラウンドでCPUを集約的に使用します
- **ディスク**: 一時的に追加のディスク容量が必要です

### 制限事項

- **同時実行**: 複数のインデックス再構築を同時に実行することはできません
- **フォルダ選択**: 再構築前にフォルダツリーでフォルダを選択する必要があります
- **処理中断**: 処理中は他の検索機能が制限される場合があります

## エラーと対処法

### よくあるエラー

#### 1. フォルダが選択されていません

**症状**: 「フォルダが選択されていません」というメッセージが表示される

**対処法**:
1. フォルダツリーペインでフォルダを選択
2. 再度インデックス再構築を実行

#### 2. 最大同時実行数に達しています

**症状**: 「最大同時実行数に達しています」というメッセージが表示される

**対処法**:
1. 現在実行中の処理が完了するまで待機
2. 完了後に再度実行

#### 3. ファイルアクセスエラー

**症状**: 特定のファイルの処理でエラーが発生

**対処法**:
- エラーファイルは自動的にスキップされます
- 処理は継続されるため、完了まで待機してください
- 必要に応じてファイルのアクセス権限を確認

#### 4. タイムアウトエラー

**症状**: 30分以上処理が応答しない場合にタイムアウトダイアログが表示される

**対処法**:
1. 「処理を中断」を選択して現在の処理を停止
2. システムリソースを確認
3. より小さなフォルダで再試行

### システムエラーの対処

#### メモリ不足

**症状**: 処理中にメモリ不足エラーが発生

**対処法**:
1. 他のアプリケーションを終了してメモリを解放
2. より小さなフォルダ単位で処理を分割
3. システムの再起動を検討

#### ディスク容量不足

**症状**: インデックス作成中にディスク容量不足エラーが発生

**対処法**:
1. 不要なファイルを削除してディスク容量を確保
2. 一時ファイルをクリーンアップ
3. 別のドライブにデータディレクトリを移動

## パフォーマンス最適化

### 処理速度の向上

1. **SSDの使用**: データディレクトリをSSDに配置
2. **メモリ増設**: 十分なRAMを確保（推奨8GB以上）
3. **CPUパフォーマンス**: 高性能CPUの使用
4. **バックグラウンドアプリ**: 不要なアプリケーションの終了

### 効率的な使用方法

1. **定期的な実行**: 週1回程度の定期実行を推奨
2. **フォルダ分割**: 大きなフォルダは小さな単位に分割
3. **除外設定**: 不要なファイル形式の除外設定
4. **時間帯の選択**: システム負荷の低い時間帯での実行

## トラブルシューティング

### ログファイルの確認

問題が発生した場合は、以下のログファイルを確認してください：

- **メインログ**: `docmind_data/logs/docmind.log`
- **再構築ログ**: `docmind_data/logs/index_rebuild.log`

### サポート情報の収集

問題報告時は以下の情報を含めてください：

1. **エラーメッセージ**: 表示された正確なエラーメッセージ
2. **処理対象**: フォルダパスとファイル数
3. **システム情報**: OS、メモリ、CPU情報
4. **ログファイル**: 関連するログファイルの内容
5. **再現手順**: エラーが発生するまでの操作手順

## よくある質問（FAQ）

### Q1: インデックス再構築はどのくらいの頻度で実行すべきですか？

**A**: 通常は週1回程度で十分です。ただし、以下の場合は即座に実行することを推奨します：
- 大量のファイルを追加・削除した後
- 検索結果が明らかに不正確な場合
- システム異常やクラッシュの後

### Q2: 処理中に他の作業はできますか？

**A**: はい、インデックス再構築はバックグラウンドで実行されるため、他の作業を継続できます。ただし、検索機能は一時的に制限される場合があります。

### Q3: 処理を途中で中断できますか？

**A**: 通常の中断機能はありませんが、30分のタイムアウト後に中断オプションが表示されます。緊急時はアプリケーションを終了することで強制中断できます。

### Q4: インデックス再構築後に検索結果が変わりますか？

**A**: はい、新しいファイルが検索対象に含まれ、古い情報が更新されるため、検索結果が改善される場合があります。

### Q5: エラーが発生したファイルはどうなりますか？

**A**: アクセスエラーが発生したファイルは自動的にスキップされ、処理可能なファイルのみでインデックスが作成されます。エラーファイルの詳細はログに記録されます。

## 関連機能

- **インデックスクリア**: 既存インデックスの完全削除
- **フォルダ管理**: インデックス対象フォルダの追加・削除
- **検索設定**: 検索パラメータの調整
- **ファイル監視**: 自動的なインデックス更新

## 更新履歴

- **v1.0.0**: 初回リリース
  - 基本的なインデックス再構築機能
  - 進捗表示とエラーハンドリング
  - タイムアウト管理機能
