了解しました。
DocMind の **main_window.py(3500行)肥大化問題**を解決するため、
**AI向けの高優先度リファクタリング指示書**を作ります。

この指示書は、将来的に GPT-5 / Claude Sonnet / Cursor / Copilot などの **IDE統合AI**に渡す前提で設計します。
AIに依頼するときに必要な「情報の粒度」「具体的な指示」「ファイル構造」「成果物要件」を含めています。

以下は「**高優先度リファクタリング指示書(テンプレート)」です。

---

# **DocMind リファクタリング指示書(高優先度)**

**対象ファイル**: `src/gui/main_window.py`
**作成日**: 2025-08-25
**作成者**: Scottlz0310
**対象AI**: GPT-5 / Claude Sonnet / Cursor AI など

---

## **1. 背景**

現在、`main_window.py` が **約3500行** に肥大化しており、
**責務の分離・保守性の向上・機能拡張のしやすさ**の観点からリファクタリングが必要です。

問題点:

* 1つのクラスまたはファイルに機能が集中
* UIイベント・検索ロジック・データ操作・設定処理などが混在
* 新機能を追加するときの衝突が頻発
* 自動テストの導入が困難

---

## **2. ゴール**

* **責務分離**: GUI・ロジック・データ操作を明確に分割
* **コード量削減**: `main_window.py`を **500行未満** に縮小
* **モジュール構造の整理**: `src/gui/` 以下にコンポーネント単位で分割
* **テスト可能性の向上**: GUI層以外はユニットテスト可能な形に

---

## **3. 優先度**

| 優先度         | 作業内容                          | 理由               |
| ----------- | ----------------------------- | ---------------- |
| **S (最優先)** | `main_window.py`の責務分離とモジュール分割 | 可読性・保守性が最も低下している |
| A           | 共通コンポーネント化(パネル類)              | 重複処理を削減          |
| B           | メソッド命名統一・Docstring整備          | 将来のAI支援を容易に      |
| C           | ログ・例外処理統一                     | デバッグ性向上          |

---

## **4. 作業手順**

### **Step 1. メソッド構造の把握**

* `main_window.py`内のメソッド・クラスをリスト化
* **methods_map.md** を作成し、以下を記録

  * クラス名 / メソッド名
  * 役割概要(1行)
  * 呼び出し関係
  * GUI or ロジック or データ層の分類

> **補足**: AIに渡すときは methods_map.md の粒度を細かくすると精度向上

---

### **Step 2. 責務ごとの分類**

分類ルールは以下の3つ：

| 区分        | 内容                   | 対応するファイル    |
| --------- | -------------------- | ----------- |
| **GUI層**  | ボタン・パネル・ダイアログ・イベント処理 | `src/gui/`  |
| **ロジック層** | 検索・インデックス・データ抽出      | `src/core/` |
| **データ層**  | DB操作・キャッシュ・ストレージ管理   | `src/data/` |

---

### **Step 3. ファイル分割計画**

提案する新しい `src/gui/` 構造:

```
src/gui/
├── main_window.py        # MainWindowクラス(エントリーポイント)
├── toolbar_panel.py      # ツールバー
├── folder_tree.py        # フォルダツリー
├── search_results.py     # 検索結果表示
├── preview_widget.py     # プレビュー表示
└── status_bar.py         # ステータスバー
```

---

### **Step 4. AIへの具体的な指示**

以下の形式で IDE統合AI に渡すとよいです：

> **プロンプト例**

```
# DocMind AIリファクタリング指示
対象: src/gui/main_window.py
目的: 責務分離・保守性改善・テスト容易化

1. methods_map.mdを読み込むこと
2. 各メソッドをGUI・ロジック・データの3分類に分ける
3. GUI関連メソッドは src/gui/XXX_panel.py に移動
4. ロジックは src/core/XXX_manager.py に委譲
5. main_window.py は "レイアウト制御とイベントディスパッチ" のみ保持
6. 既存のテストを壊さないように関数シグネチャは極力変更しない
7. PEP8に準拠し、docstringも付与すること
```

---

### **Step 5. 成果物**

* 新しい `src/gui/*.py` ファイル群
* 更新された `main_window.py`
* `methods_map.md`(メソッドマップ)
* リファクタリング後の依存関係図(AI生成可)

---

## **5. 補足**

* methods_map.md の整備が非常に重要
* 一度に全メソッドをAIに渡すより、**GUI・ロジック・データの3つに小分けして依頼**すると精度が高い
* 完了後は `tests/` 以下で自動テストを書くと、将来のバグを防止できる

---

## **6. 次のアクション**

1. `grep -E 'def |class '` で main_window.py 内のクラス・メソッド一覧を抽出
2. `methods_map.md` を作成
3. 上記指示書をAIに渡してリファクタリング開始

---

こうしておけば、Claude Sonnet や Cursor でも迷わず作業を進められます。

---
