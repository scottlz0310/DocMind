# GUI層複雑度分析

## 📊 GUI層ファイル別複雑度

| ファイル | 行数 | クラス数 | メソッド数 | 複雑度指標 | 問題レベル |
|----------|------|----------|------------|------------|------------|
| `main_window.py` | 3,605行 | 1 | 112 | 🚨 **極度** | 1クラスに112メソッド |
| `search_interface.py` | 1,504行 | 7 | 79 | 🔥 **高** | 平均11.3メソッド/クラス |
| `folder_tree.py` | 1,409行 | 5 | 75 | 🔥 **高** | 平均15メソッド/クラス |
| `search_results.py` | 758行 | 3 | 44 | ⚠️ **中** | 平均14.7メソッド/クラス |
| `preview_widget.py` | 751行 | 4 | 38 | ⚠️ **中** | 平均9.5メソッド/クラス |
| `settings_dialog.py` | 600行 | 1 | 18 | ⚠️ **中** | 1クラスに18メソッド |
| `error_dialog.py` | 435行 | 3 | 16 | ✅ **適正** | 平均5.3メソッド/クラス |
| `resources.py` | - | 0 | 0 | ✅ **適正** | ユーティリティ関数のみ |

## 🚨 最重要問題: main_window.py

### 問題の深刻度
```
- 1つのクラスに112個のメソッド
- 3,605行の巨大ファイル
- 責務の完全な混在
```

### 主要メソッド分類(推定)
- **UI構築系**: ~20メソッド
- **イベントハンドラ系**: ~30メソッド
- **検索・インデックス管理系**: ~25メソッド
- **ダイアログ・エラー処理系**: ~20メソッド
- **設定・状態管理系**: ~17メソッド

## 🎯 リファクタリング戦略

### Phase 1: main_window.py 緊急分割

#### 1.1 UI管理系の分離
```python
# 新規ファイル: src/gui/managers/
├── menu_manager.py      # メニューバー管理
├── toolbar_manager.py   # ツールバー管理
├── status_manager.py    # ステータスバー管理
└── layout_manager.py    # レイアウト管理
```

#### 1.2 機能別コントローラーの分離
```python
# 新規ファイル: src/gui/controllers/
├── search_controller.py    # 検索機能制御
├── index_controller.py     # インデックス管理制御
├── preview_controller.py   # プレビュー制御
└── folder_controller.py    # フォルダ管理制御
```

#### 1.3 ダイアログ・エラー処理の分離
```python
# 新規ファイル: src/gui/dialogs/
├── progress_dialogs.py     # 進捗ダイアログ群
├── confirmation_dialogs.py # 確認ダイアログ群
└── error_handlers.py       # エラーハンドリング
```

### Phase 2: 他の高複雑度ファイルの改善

#### 2.1 search_interface.py (7クラス, 79メソッド)
- 検索UI、検索ワーカー、進捗管理が混在
- 検索UI専用クラスと検索処理クラスに分離

#### 2.2 folder_tree.py (5クラス, 75メソッド)
- フォルダツリー表示、ファイル監視、インデックス状態管理が混在
- 表示ロジックと状態管理を分離

## 📈 期待される改善効果

### main_window.py 分割後の目標
```
現在: 1クラス, 112メソッド, 3,605行
目標: 1クラス, 20メソッド, 300行以下

分離されるメソッド数:
- UI管理系: 25メソッド → managers/
- 機能制御系: 40メソッド → controllers/
- ダイアログ系: 27メソッド → dialogs/
```

### 全体的な改善目標
```
GUI層総行数: 8,662行 → 5,000行以下
平均メソッド数/クラス: 15.2 → 8以下
最大ファイル行数: 3,605行 → 800行以下
```

## 🔧 実装優先順位

### 最優先(今週実施)
1. `main_window.py` のダイアログ系メソッド分離
2. `main_window.py` のUI管理系メソッド分離

### 高優先(来週実施)
3. `main_window.py` の機能制御系メソッド分離
4. `search_interface.py` の責務分離

### 中優先(2週間後)
5. `folder_tree.py` の責務分離
6. 残りのGUIファイルの最適化

## ⚠️ リスク管理

### 分割時の注意点
- **シグナル・スロット接続の維持**
- **import文の循環参照回避**
- **既存テストの動作保証**
- **段階的な移行による機能保持**

### 検証方法
- 各段階でのアプリケーション動作確認
- 既存テストスイートの実行
- メモリ使用量・起動時間の測定