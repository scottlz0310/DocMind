# リファクタリング基本原則

## 🎯 リファクタリングの真の目的

### 主要目標（優先順位順）
1. **保守性の向上** - コードの理解・修正が容易になること
2. **責務の分離** - 各コンポーネントが明確な役割を持つこと  
3. **テスト容易性** - 個別テストが可能になること
4. **拡張性の確保** - 新機能追加時の影響を最小化すること

### 副次的効果（結果として得られるもの）
- 行数削減
- ファイルサイズ縮小
- 複雑度低減

## ⚖️ 判断基準

### 良いリファクタリング
- ✅ 責務が明確に分離されている
- ✅ 各コンポーネントが独立してテスト可能
- ✅ コードの意図が理解しやすい
- ✅ 適切なdocstringとコメントがある
- ✅ 新機能追加時の影響範囲が限定的

### 悪いリファクタリング
- ❌ 行数削減のためだけにdocstringを削除
- ❌ 数値目標達成のために可読性を犠牲
- ❌ 過度な抽象化で理解困難
- ❌ 責務が不明確な巨大クラス
- ❌ テストが困難な密結合

## 📏 適切な成功指標

### 定量的指標（参考値）
- 行数削減: 50-90%（結果として）
- ファイル分割: 1つ → 5-10個（責務に応じて）
- メソッド数: 20個以下/ファイル（目安）

### 定性的指標（重要）
- **理解容易性**: 6ヶ月後の自分が理解できるか
- **修正容易性**: 特定機能の修正が他に影響しないか
- **テスト容易性**: 各コンポーネントを個別にテスト可能か
- **拡張容易性**: 新機能追加が既存コードに影響しないか

## 🚫 避けるべき行為

### 数値至上主義
- 行数削減を最優先にする
- 目標数値達成のために品質を犠牲にする
- docstringやコメントを削除して行数を減らす

### 過度な最適化
- 必要以上の抽象化
- 理解困難な複雑な構造
- 一度に大量の変更を行う

### 目的の見失い
- リファクタリングの本来の目的を忘れる
- 手段と目的を混同する
- 短期的な数値改善に固執する

## ✅ 推奨アプローチ

### 段階的改善
1. **責務の特定** - 現在のコードが担っている責務を明確化
2. **分離計画** - どの責務をどのように分離するか計画
3. **段階的実装** - 一度に一つの責務を分離
4. **検証** - 各段階で動作確認とテスト実行
5. **品質確認** - 可読性・保守性が向上したか確認

### 品質維持
- 適切なdocstringを必ず記述
- 意図を明確にするコメントを追加
- 型ヒントで可読性を向上
- 命名規則を統一

### 継続的改善
- 完璧を求めず、段階的に改善
- 行数目標は目安として参考程度に
- 品質向上を最優先に判断
- 将来の保守者への配慮を忘れない

## 📝 記録と振り返り

### 成功事例の記録
- 何がうまくいったか
- どのような判断基準を使ったか
- 結果として得られた効果

### 失敗事例の記録
- 何が問題だったか
- どのような判断ミスがあったか
- 今後の改善策

### 継続的学習
- リファクタリングの原則を定期的に見直し
- 新しい手法や考え方を学習
- チーム内での知識共有

---
**作成日**: 2025-08-28
**目的**: リファクタリングの真の目的を見失わないための指針
**重要度**: 🔴 最高 - 全てのリファクタリング作業で参照必須