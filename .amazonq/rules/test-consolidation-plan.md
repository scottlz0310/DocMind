# テスト統合計画

## 重複テストファイル分析結果

### 1. 深刻な重複パターン

#### 1.1 DocumentProcessor関連
- `test_document_processor.py` (基本版)
- `test_document_processor_phase7.py` (強化版)

**重複内容:**
- 初期化テスト
- ファイル処理テスト（PDF、Word、Excel、Markdown、テキスト）
- エラーハンドリングテスト
- エンコーディング検出テスト
- 大規模ファイル処理テスト

**統合方針:** phase7版をベースに基本版の有用なテストケースを統合

#### 1.2 EmbeddingManager関連
- `test_embedding_manager.py` (基本版)
- `test_embedding_manager_phase7.py` (強化版)

**重複内容:**
- 埋め込み生成精度テスト
- キャッシュパフォーマンステスト
- バッチ処理効率テスト
- 類似度計算テスト
- 永続化テスト
- メモリ効率テスト

**統合方針:** phase7版をベースに基本版の独自テストケースを統合

#### 1.3 IndexManager関連
- `test_index_manager.py` (基本版)
- `test_index_manager_phase7.py` (強化版)
- `test_index_manager_phase7_fixed.py` (修正版)

**重複内容:**
- 大規模インデックス作成テスト
- 増分更新パフォーマンステスト
- インデックス最適化テスト
- メモリ効率テスト
- エラーハンドリングテスト

**統合方針:** fixed版をベースに他の版の有用なテストケースを統合

#### 1.4 SearchManager関連
- `test_search_manager.py` (基本版、スキップ済み)
- `test_search_manager_phase7.py` (強化版、スキップ済み)

**重複内容:**
- ハイブリッド検索精度テスト
- セマンティック検索パフォーマンステスト
- 全文検索速度テスト
- 並行検索パフォーマンステスト
- 検索結果ランキング品質テスト

**統合方針:** APIが変更されているため、現在のAPIに合わせて統合版を作成

#### 1.5 FileWatcher関連
- `test_file_watcher.py` (基本版)
- `test_file_watcher_phase7.py` (強化版)

**重複内容:**
- 初期化テスト
- 監視開始/停止テスト
- パス追加/削除テスト
- 統計情報取得テスト
- エラーハンドリングテスト

**統合方針:** phase7版をベースに基本版の独自テストケースを統合

### 2. その他の重複ファイル

#### 2.1 Core関連の重複
- `test_core_simplified.py`
- `test_core_simplified_fixed.py`
- `test_core_coverage_focused.py`

**統合方針:** coverage_focused版をベースに他の版の有用なテストケースを統合

#### 2.2 アーカイブされた重複テスト
- `archive/legacy_tests_phase4_20250830_130524/` 配下の大量の重複テスト

**統合方針:** 完全削除（既にアーカイブ済み）

### 3. 統合実行計画

#### Phase 1: 重複ファイル統合（優先度：高）

1. **DocumentProcessor統合**
   - `test_document_processor_phase7.py` をベースファイルとして採用
   - `test_document_processor.py` から独自のテストケースを抽出・統合
   - 統合後、基本版を削除

2. **EmbeddingManager統合**
   - `test_embedding_manager_phase7.py` をベースファイルとして採用
   - `test_embedding_manager.py` から独自のテストケースを抽出・統合
   - 統合後、基本版を削除

3. **IndexManager統合**
   - `test_index_manager_phase7_fixed.py` をベースファイルとして採用
   - 他の2つのファイルから独自のテストケースを抽出・統合
   - 統合後、他の版を削除

4. **FileWatcher統合**
   - `test_file_watcher_phase7.py` をベースファイルとして採用
   - `test_file_watcher.py` から独自のテストケースを抽出・統合
   - 統合後、基本版を削除

#### Phase 2: SearchManager再構築（優先度：中）

1. **現在のAPI調査**
   - SearchManagerの現在のAPIを調査
   - 必要なテストケースを特定

2. **統合テスト作成**
   - 既存の2つのファイルから有用なテストケースを抽出
   - 現在のAPIに合わせて新しいテストファイルを作成
   - 既存の2つのファイルを削除

#### Phase 3: Core関連統合（優先度：低）

1. **Core統合**
   - `test_core_coverage_focused.py` をベースとして採用
   - 他のファイルから独自のテストケースを抽出・統合
   - 統合後、他の版を削除

#### Phase 4: アーカイブクリーンアップ（優先度：低）

1. **レガシーテスト削除**
   - `archive/legacy_tests_phase4_20250830_130524/` ディレクトリを完全削除
   - 必要に応じてバックアップを作成

### 4. 統合後の期待効果

#### 4.1 テストファイル数削減
- **現在:** 約80個のテストファイル
- **統合後:** 約40個のテストファイル（50%削減）

#### 4.2 保守性向上
- 重複テストの削除により、テスト修正時の作業量削減
- テストケースの一元化により、品質向上

#### 4.3 実行時間短縮
- 重複テストの削除により、CI実行時間短縮
- テストカバレッジの重複排除

### 5. 統合時の注意事項

#### 5.1 テストカバレッジ維持
- 統合前後でテストカバレッジが低下しないよう注意
- 削除するテストケースが独自の価値を持つかを慎重に判断

#### 5.2 テスト品質維持
- 統合時にテストケースの品質を向上させる
- 不適切なテストケース（カバレッジ稼ぎ等）は削除

#### 5.3 段階的実行
- 一度に全てを統合せず、段階的に実行
- 各段階でテスト実行を確認

### 6. 実装優先順位

1. **最優先:** DocumentProcessor、EmbeddingManager、IndexManager、FileWatcher
2. **中優先:** SearchManager再構築
3. **低優先:** Core関連統合、アーカイブクリーンアップ

### 7. 品質ルール遵守

統合作業は以下のルールに従って実行：

- **禁止事項の厳守**
  - カバレッジ稼ぎのみを目的としたテスト削除
  - 無意味なassert文の削除
  - 既存テストと重複するファイルの削除

- **必須事項の遵守**
  - 各テストに目的をコメントで明記
  - 入力と出力の関係を正しく検証
  - カバレッジレポートの確認と未カバー行の特定

- **統合方針**
  - 既存test_*.py内での統合を優先
  - 新規テスト作成は例外的な場合のみ
  - 各テストケースの独自性を保持