# folder_tree.py å®Œå…¨åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“Š **åŸºæœ¬çµ±è¨ˆæƒ…å ±**

### **ãƒ•ã‚¡ã‚¤ãƒ«è¦æ¨¡**
- **ç·è¡Œæ•°**: 1,408è¡Œ
- **ã‚¯ãƒ©ã‚¹æ•°**: 5å€‹
- **ãƒ¡ã‚½ãƒƒãƒ‰æ•°**: 76å€‹
- **ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ•°**: 30å€‹

### **ãƒªã‚¹ã‚¯è©•ä¾¡çµæœ**
- **ç·åˆãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«**: ğŸ”´ **HIGH**
- **è¤‡é›‘åº¦ãƒªã‚¹ã‚¯**: ğŸŸ¢ LOW (å¹³å‡2.8, æœ€å¤§26)
- **éåŒæœŸå‡¦ç†ãƒªã‚¹ã‚¯**: ğŸŸ¡ MEDIUM (20ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
- **Qtä¾å­˜é–¢ä¿‚ãƒªã‚¹ã‚¯**: ğŸ”´ HIGH (108ä¾å­˜)
- **ã‚·ã‚°ãƒŠãƒ«ãƒ»ã‚¹ãƒ­ãƒƒãƒˆãƒªã‚¹ã‚¯**: ğŸ”´ HIGH (61ä½¿ç”¨ç®‡æ‰€)

## ğŸ—ï¸ **ã‚¯ãƒ©ã‚¹æ§‹é€ åˆ†æ**

### **1. FolderLoadWorker (26-140è¡Œ)**
**è²¬å‹™**: éåŒæœŸãƒ•ã‚©ãƒ«ãƒ€èª­ã¿è¾¼ã¿å‡¦ç†
**ç¶™æ‰¿**: QObject
**ãƒ¡ã‚½ãƒƒãƒ‰æ•°**: 4å€‹
**ãƒªã‚¹ã‚¯**: ğŸ”´ **æ¥µé«˜** (éåŒæœŸå‡¦ç†ã®ä¸­æ ¸)

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `do_work()` - ãƒ¡ã‚¤ãƒ³å‡¦ç† (è¤‡é›‘åº¦: 3)
- `_load_folder_recursive()` - å†å¸°èª­ã¿è¾¼ã¿ (è¤‡é›‘åº¦: 26) âš ï¸ **æœ€é«˜è¤‡é›‘åº¦**
- `stop()` - å‡¦ç†åœæ­¢
- ã‚·ã‚°ãƒŠãƒ«: `folder_loaded`, `load_error`, `finished`

**åˆ†é›¢æˆ¦ç•¥**: æœ€å„ªå…ˆã§ç‹¬ç«‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–

### **2. FolderItemType (141-149è¡Œ)**
**è²¬å‹™**: ãƒ•ã‚©ãƒ«ãƒ€ã‚¢ã‚¤ãƒ†ãƒ ç¨®é¡å®šç¾©
**ç¶™æ‰¿**: Enum
**ãƒ¡ã‚½ãƒƒãƒ‰æ•°**: 0å€‹
**ãƒªã‚¹ã‚¯**: ğŸŸ¢ **ä½** (å˜ç´”ãªåˆ—æŒ™å‹)

**åˆ†é›¢æˆ¦ç•¥**: å…±é€šå®šç¾©ã¨ã—ã¦ç‹¬ç«‹

### **3. FolderTreeItem (151-245è¡Œ)**
**è²¬å‹™**: ãƒ„ãƒªãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®æ‹¡å¼µ
**ç¶™æ‰¿**: QTreeWidgetItem
**ãƒ¡ã‚½ãƒƒãƒ‰æ•°**: 4å€‹
**ãƒªã‚¹ã‚¯**: ğŸŸ¡ **ä¸­** (UIä¾å­˜)

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `set_folder_data()` - ãƒ‡ãƒ¼ã‚¿è¨­å®š (è¤‡é›‘åº¦: 2)
- `_update_icon()` - ã‚¢ã‚¤ã‚³ãƒ³æ›´æ–° (è¤‡é›‘åº¦: 7)
- `update_statistics()` - çµ±è¨ˆæ›´æ–° (è¤‡é›‘åº¦: 5)

**åˆ†é›¢æˆ¦ç•¥**: UIç®¡ç†ç³»ã«çµ±åˆ

### **4. FolderTreeWidget (246-1206è¡Œ) âš ï¸ **æœ€å¤§ã‚¯ãƒ©ã‚¹**
**è²¬å‹™**: ãƒ¡ã‚¤ãƒ³ãƒ„ãƒªãƒ¼ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ
**ç¶™æ‰¿**: QTreeWidget
**ãƒ¡ã‚½ãƒƒãƒ‰æ•°**: 47å€‹ (å…¨ä½“ã®62%)
**è¡Œæ•°**: 960è¡Œ (å…¨ä½“ã®68%)
**ãƒªã‚¹ã‚¯**: ğŸ”´ **æ¥µé«˜** (å·¨å¤§ãƒ»è¤‡é›‘ãƒ»å¤šè²¬å‹™)

**è²¬å‹™åˆ†æ**:
1. **éåŒæœŸå‡¦ç†ç®¡ç†** (8ãƒ¡ã‚½ãƒƒãƒ‰)
2. **UIè¨­å®šãƒ»ç®¡ç†** (12ãƒ¡ã‚½ãƒƒãƒ‰)
3. **ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†** (15ãƒ¡ã‚½ãƒƒãƒ‰)
4. **çŠ¶æ…‹ç®¡ç†** (12ãƒ¡ã‚½ãƒƒãƒ‰)

**åˆ†é›¢æˆ¦ç•¥**: 4ã¤ã®å°‚é–€é ˜åŸŸã«åˆ†å‰²

### **5. FolderTreeContainer (1208-1408è¡Œ)**
**è²¬å‹™**: ã‚³ãƒ³ãƒ†ãƒŠã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ
**ç¶™æ‰¿**: QWidget
**ãƒ¡ã‚½ãƒƒãƒ‰æ•°**: 20å€‹
**ãƒªã‚¹ã‚¯**: ğŸŸ¡ **ä¸­** (æ¯”è¼ƒçš„å˜ç´”)

**åˆ†é›¢æˆ¦ç•¥**: æœ€å¾Œã«è»½å¾®ãªèª¿æ•´

## ğŸ”„ **éåŒæœŸå‡¦ç†åˆ†æ**

### **éåŒæœŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (20å€‹)**
- **ã‚¹ãƒ¬ãƒƒãƒ‰é–¢é€£**: `QThread`, `Worker`, `moveToThread` (7ç®‡æ‰€)
- **ã‚·ã‚°ãƒŠãƒ«**: `started`, `finished` (10ç®‡æ‰€)
- **åˆ¶å¾¡ãƒ¡ã‚½ãƒƒãƒ‰**: `start()`, `quit()`, `terminate()` (3ç®‡æ‰€)

### **éåŒæœŸå‡¦ç†ãƒ•ãƒ­ãƒ¼**
```
1. load_folder_structure() 
   â†“
2. _load_subfolders_async()
   â†“
3. FolderLoadWorkerä½œæˆãƒ»ã‚¹ãƒ¬ãƒƒãƒ‰ç§»å‹•
   â†“
4. ã‚·ã‚°ãƒŠãƒ«æ¥ç¶š (folder_loaded, load_error, finished)
   â†“
5. ã‚¹ãƒ¬ãƒƒãƒ‰é–‹å§‹
   â†“
6. _load_folder_recursive() (ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œ)
   â†“
7. çµæœã‚·ã‚°ãƒŠãƒ«ç™ºè¡Œ
   â†“
8. _on_folder_loaded() / _on_load_error()
   â†“
9. _cleanup_worker()
```

### **éåŒæœŸå‡¦ç†ãƒªã‚¹ã‚¯**
- **è¤‡é›‘ãªã‚·ã‚°ãƒŠãƒ«æ¥ç¶š**: Qt.QueuedConnectionä½¿ç”¨
- **ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«**: é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å¿…è¦
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å¤šæ®µéšã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
- **ãƒ¡ãƒ¢ãƒªç®¡ç†**: deleteLater()ã«ã‚ˆã‚‹è‡ªå‹•å‰Šé™¤

## ğŸ“¡ **ã‚·ã‚°ãƒŠãƒ«ãƒ»ã‚¹ãƒ­ãƒƒãƒˆåˆ†æ**

### **ã‚·ã‚°ãƒŠãƒ«å®šç¾© (11å€‹)**
- `folder_loaded`, `load_error`, `finished` (Worker)
- `folder_selected`, `folder_indexed`, `folder_excluded`, `refresh_requested` (Widget)
- é‡è¤‡å®šç¾©ã‚ã‚Š (Container)

### **ã‚·ã‚°ãƒŠãƒ«æ¥ç¶š (33ç®‡æ‰€)**
- **UI ã‚¤ãƒ™ãƒ³ãƒˆ**: `itemSelectionChanged`, `itemExpanded` ç­‰
- **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: `triggered` (7ç®‡æ‰€)
- **ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ**: `activated` (3ç®‡æ‰€)
- **éåŒæœŸ**: `started`, `finished` ç­‰
- **ã‚«ã‚¹ã‚¿ãƒ **: `folder_selected` ç­‰

### **ã‚·ã‚°ãƒŠãƒ«ç™ºè¡Œ (16ç®‡æ‰€)**
- **ã‚¨ãƒ©ãƒ¼é€šçŸ¥**: `load_error` (6ç®‡æ‰€)
- **å®Œäº†é€šçŸ¥**: `finished`, `folder_loaded`
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: `folder_selected`, `folder_indexed` ç­‰

## ğŸ¨ **UIä¾å­˜é–¢ä¿‚åˆ†æ**

### **Qt Widgetä¾å­˜ (108ç®‡æ‰€)**
- **ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ**: `QTreeWidget`, `QWidget`, `QVBoxLayout` ç­‰ (30ç®‡æ‰€)
- **ã‚³ã‚¢**: `QThread`, `QObject`, `QTimer` (7ç®‡æ‰€)
- **ã‚·ã‚°ãƒŠãƒ«**: `Signal`, `connect`, `emit` (71ç®‡æ‰€)

### **UIæ“ä½œåˆ†æ**
- **ãƒ„ãƒªãƒ¼æ“ä½œ**: `addTopLevelItem`, `currentItem` ç­‰ (10ç®‡æ‰€)
- **ã‚¢ã‚¤ãƒ†ãƒ æ“ä½œ**: `setExpanded`, `setHidden` (5ç®‡æ‰€)
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: `setStyleSheet`, `setIcon`, `setToolTip` (11ç®‡æ‰€)

## ğŸ“‹ **Phase4åˆ†é›¢æˆ¦ç•¥**

### **Week 1: éåŒæœŸå‡¦ç†åˆ†é›¢**
**å¯¾è±¡**: `FolderLoadWorker` + é–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰
**æ–°æ§‹é€ **:
```
src/gui/folder_tree/
â”œâ”€â”€ loaders/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ folder_load_worker.py      # FolderLoadWorker
â”‚   â”œâ”€â”€ async_manager.py           # éåŒæœŸå‡¦ç†ç®¡ç†
â”‚   â””â”€â”€ thread_coordinator.py     # ã‚¹ãƒ¬ãƒƒãƒ‰èª¿æ•´
```

**åˆ†é›¢ãƒ¡ã‚½ãƒƒãƒ‰**:
- `_load_subfolders_async()`
- `_on_folder_loaded()`
- `_on_load_error()`
- `_cleanup_worker()`
- `_on_load_finished()`

### **Week 2: çŠ¶æ…‹ç®¡ç†åˆ†é›¢**
**å¯¾è±¡**: çŠ¶æ…‹ç®¡ç†é–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰
**æ–°æ§‹é€ **:
```
src/gui/folder_tree/
â”œâ”€â”€ state/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ folder_state_manager.py    # çµ±ä¸€çŠ¶æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ index_tracker.py           # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹çŠ¶æ…‹
â”‚   â””â”€â”€ selection_coordinator.py   # é¸æŠçŠ¶æ…‹
```

**åˆ†é›¢ãƒ¡ã‚½ãƒƒãƒ‰**:
- `set_folder_indexing()`
- `set_folder_indexed()`
- `set_folder_error()`
- `clear_folder_state()`
- `_update_item_types()`
- çŠ¶æ…‹ã‚»ãƒƒãƒˆç®¡ç† (`indexed_paths`, `excluded_paths` ç­‰)

### **Week 3: UIç®¡ç†åˆ†é›¢**
**å¯¾è±¡**: UIæ§‹ç¯‰ãƒ»ç®¡ç†ãƒ¡ã‚½ãƒƒãƒ‰
**æ–°æ§‹é€ **:
```
src/gui/folder_tree/
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ tree_widget_manager.py     # ãƒ„ãƒªãƒ¼ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆç®¡ç†
â”‚   â”œâ”€â”€ item_factory.py            # ã‚¢ã‚¤ãƒ†ãƒ ç”Ÿæˆ
â”‚   â””â”€â”€ display_coordinator.py     # è¡¨ç¤ºèª¿æ•´
```

**åˆ†é›¢ãƒ¡ã‚½ãƒƒãƒ‰**:
- `_setup_tree_widget()`
- `_setup_context_menu()`
- `_setup_shortcuts()`
- `filter_folders()` + ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–¢é€£
- `_update_statistics()`

### **Week 4: ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†åˆ†é›¢**
**å¯¾è±¡**: ã‚¤ãƒ™ãƒ³ãƒˆãƒ»ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
**æ–°æ§‹é€ **:
```
src/gui/folder_tree/
â”œâ”€â”€ events/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ tree_event_handler.py      # ãƒ„ãƒªãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ context_menu_manager.py    # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”‚   â””â”€â”€ signal_coordinator.py      # ã‚·ã‚°ãƒŠãƒ«èª¿æ•´
```

**åˆ†é›¢ãƒ¡ã‚½ãƒƒãƒ‰**:
- `_on_selection_changed()` ç­‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- `_show_context_menu()` + ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼é–¢é€£
- `_add_folder()`, `_remove_folder()` ç­‰ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

## âš ï¸ **Phase4ãƒªã‚¹ã‚¯è¦å› ã¨å¯¾ç­–**

### **é«˜ãƒªã‚¹ã‚¯è¦å› **
1. **éåŒæœŸå‡¦ç†ã®è¤‡é›‘æ€§**
   - **ãƒªã‚¹ã‚¯**: ã‚¹ãƒ¬ãƒƒãƒ‰é–“é€šä¿¡ã€ã‚·ã‚°ãƒŠãƒ«æ¥ç¶šã®è¤‡é›‘ã•
   - **å¯¾ç­–**: æ®µéšçš„åˆ†é›¢ã€å¾¹åº•çš„ãªãƒ†ã‚¹ãƒˆ

2. **Qt UIä¾å­˜é–¢ä¿‚**
   - **ãƒªã‚¹ã‚¯**: 108ç®‡æ‰€ã®Qtä¾å­˜ã€å¯†çµåˆ
   - **å¯¾ç­–**: æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼å°å…¥ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åˆ†é›¢

3. **ã‚·ã‚°ãƒŠãƒ«ãƒ»ã‚¹ãƒ­ãƒƒãƒˆæ¥ç¶š**
   - **ãƒªã‚¹ã‚¯**: 61ç®‡æ‰€ã®è¤‡é›‘ãªæ¥ç¶šé–¢ä¿‚
   - **å¯¾ç­–**: æ¥ç¶šãƒãƒƒãƒ—ä½œæˆã€æ®µéšçš„ç§»è¡Œ

4. **çŠ¶æ…‹ç®¡ç†ã®è¤‡é›‘æ€§**
   - **ãƒªã‚¹ã‚¯**: è¤‡æ•°çŠ¶æ…‹ã‚»ãƒƒãƒˆã®æ•´åˆæ€§
   - **å¯¾ç­–**: çµ±ä¸€çŠ¶æ…‹ç®¡ç†ã‚¯ãƒ©ã‚¹å°å…¥

### **å¯¾ç­–ã®å„ªå…ˆé †ä½**
1. **æœ€å„ªå…ˆ**: éåŒæœŸå‡¦ç†ã®å®‰å…¨ãªåˆ†é›¢
2. **é«˜å„ªå…ˆ**: çŠ¶æ…‹ç®¡ç†ã®çµ±ä¸€åŒ–
3. **ä¸­å„ªå…ˆ**: UIä¾å­˜é–¢ä¿‚ã®æŠ½è±¡åŒ–
4. **ä½å„ªå…ˆ**: ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã®æ•´ç†

## ğŸ“Š **æœŸå¾…æˆæœ**

### **åˆ†é›¢å¾Œã®æ§‹é€ **
```
folder_tree.py (1,408è¡Œ) 
â†“
â”œâ”€â”€ folder_tree.py (200è¡Œ) - çµ±åˆç®¡ç†ã®ã¿
â”œâ”€â”€ loaders/ (300è¡Œ) - éåŒæœŸå‡¦ç†
â”œâ”€â”€ state/ (250è¡Œ) - çŠ¶æ…‹ç®¡ç†
â”œâ”€â”€ ui/ (400è¡Œ) - UIç®¡ç†
â””â”€â”€ events/ (258è¡Œ) - ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
```

### **å‰Šæ¸›ç›®æ¨™**
- **è¡Œæ•°å‰Šæ¸›**: 1,408è¡Œ â†’ 200è¡Œ (85.8%å‰Šæ¸›)
- **ãƒ¡ã‚½ãƒƒãƒ‰å‰Šæ¸›**: 76å€‹ â†’ 15å€‹ä»¥ä¸‹ (80%å‰Šæ¸›)
- **è²¬å‹™åˆ†é›¢**: 4ã¤ã®å°‚é–€é ˜åŸŸã«åˆ†é›¢
- **ä¿å®ˆæ€§å‘ä¸Š**: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç‹¬ç«‹ä¿®æ­£å¯èƒ½

### **å“è³ªå‘ä¸Š**
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½“ãƒ†ã‚¹ãƒˆå¯èƒ½
- **å¯èª­æ€§**: è²¬å‹™ãŒæ˜ç¢ºã€ç†è§£ã—ã‚„ã™ã„
- **æ‹¡å¼µæ€§**: æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®å½±éŸ¿æœ€å°åŒ–
- **å®‰å®šæ€§**: ã‚¨ãƒ©ãƒ¼å½±éŸ¿ç¯„å›²ã®é™å®šåŒ–

---
**ä½œæˆæ—¥**: 2025-08-28
**åˆ†æå¯¾è±¡**: src/gui/folder_tree.py (1,408è¡Œ, 76ãƒ¡ã‚½ãƒƒãƒ‰)
**åˆ†æçµæœ**: ç·åˆãƒªã‚¹ã‚¯HIGHã€Phase4å®Ÿè¡Œæ¨å¥¨
**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: Week 0 Day 2 ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰